--Hierarchical query: Reports-to chain

SET SCHEMA CORPDATA;

DROP corpdata.TABLE MY_EMP;

CREATE TABLE corpdata.MY_EMP
  (
   EMPID INTEGER NOT NULL PRIMARY KEY, 
   NAME VARCHAR(10),
   SALARY DECIMAL(9, 2),
   MGRID INTEGER   
  )
;

INSERT INTO MY_EMP VALUES ( 1, 'Jones', 30000, 10);
INSERT INTO MY_EMP VALUES ( 2, 'Hall', 35000, 10);
INSERT INTO MY_EMP VALUES ( 3, 'Kim', 40000, 10);
INSERT INTO MY_EMP VALUES ( 4, 'Lindsay', 38000, 10);
INSERT INTO MY_EMP VALUES ( 5, 'McKeough', 42000, 11);
INSERT INTO MY_EMP VALUES ( 6, 'Barnes', 41000, 11);
INSERT INTO MY_EMP VALUES ( 7, 'O''Neil', 36000, 12);
INSERT INTO MY_EMP VALUES ( 8, 'Smith', 34000, 12);
INSERT INTO MY_EMP VALUES ( 9, 'Shoeman', 33000, 12);
INSERT INTO MY_EMP VALUES (10, 'Monroe', 50000, 15);
INSERT INTO MY_EMP VALUES (11, 'Zander', 52000, 16);
INSERT INTO MY_EMP VALUES (12, 'Henry', 51000, 16);
INSERT INTO MY_EMP VALUES (13, 'Aaron', 54000, 15);
INSERT INTO MY_EMP VALUES (14, 'Scott', 53000, 16);
INSERT INTO MY_EMP VALUES (15, 'Mills', 70000, 17);
INSERT INTO MY_EMP VALUES (16, 'Goyal', 80000, 17);
INSERT INTO MY_EMP VALUES (17, 'Urbassek', 95000, NULL);


SELECT NAME, LEVEL, SALARY,
       CONNECT_BY_ROOT NAME AS ROOT, 
       CAST(SYS_CONNECT_BY_PATH(NAME, ':') AS VARCHAR(200)) AS CHAIN
FROM MY_EMP
  START WITH NAME = 'Goyal'
  CONNECT BY PRIOR EMPID = MGRID
  ORDER SIBLINGS BY SALARY
;
SET SCHEMA DEFAULT 
